<!DOCTYPE html>
    <html>

    <head>
        <meta charset="UTF-8">
        {% block style %}{% endblock %}
        <link rel="stylesheet" href="{{asset('fontawesome-free-6.5.0-web/css/all.css')}}">
        <link rel="stylesheet" href="{{asset('bootstrap-5.3.3-dist/css/bootstrap.css')}}">
        <link rel="stylesheet" href="{{asset('css/style.css')}}">
        <title>
            {% block title %}
            {{ title|default("Gestion commerciale")}}
            {% endblock %}
        </title>
    </head>

    <body>
        <div class="container-fluid p-0">
            <header class="bg-secondary">
                <h1 class="text-center bg-dark text-white m-0">GESTION COMMERCIALE</h1>
                <div id="banner">
                    <video autoplay loop muted src="{{asset('img/vid3.mp4')}}" width="100%"></video>
                </div>
                <nav class="navbar navbar-expand-md bg-dark text-dark">
                    <a href="" class="text-white mx-2">
                        <i class="fa fa-laptop fa-2x"></i>
                    </a>
                    <a href="#nav" class="btn bg-white mx-2 navbar-toggler" data-bs-toggle="collapse">
                        <i class="fa fa-bars"></i>
                    </a>
                    <div class="collapse navbar-collapse justify-content-between" id="nav">
                        <ul class="nav navbar-nav">
                            <li class="nav-item ms-2">
                                <a href="{{ path('app_accueil') }}" class="nav-link text-white fs-4">Accueil</a>
                            </li>
                            <li class="nav-item ms-2">
                                <a href="/vente/mouvement" class="nav-link text-white fs-4">Mouvement</a>
                            </li>
                            <li class="nav-item ms-2">
                                <a href="/depot/produit" class="nav-link text-white fs-4">Produit</a>
                            </li>
                            <li class="nav-item ms-2">
                                <a href="/vente/tiers" class="nav-link text-white fs-4">Tiers</a>
                            </li>
                            <li class="dropdown nav-item ms-2">
                                <a href="" class="nav-link text-white fs-4 dropdown-toggle" data-bs-toggle="dropdown"
                                    data-bs-auto-close="outside">Commande</a>
                                <ul class="dropdown-menu bg-dark">
                                    <li class="dropend nav-item ms-2">
                                        <a href="" class="nav-link dropdown-toggle text-white"
                                            data-bs-toggle="dropdown">Vente</a>
                                        <ul class="dropdown-menu bg-dark">
                                            <li class="nav-item ms-2">
                                                <a href="" class="nav-link text-white">Au Comptant</a>
                                            </li>
                                            <li class="nav-item ms-2">
                                                <a href="" class="nav-link text-white">A Crédit</a>
                                            </li>
                                            <li class="nav-item ms-2">
                                                <a href="" class="nav-link text-white">Offerte</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="" class="nav-link text-white">Appro</a>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="" class="nav-link text-white">Interne</a>
                                    </li>
                                </ul>
                            </li>
                            {% if(is_granted("ROLE_ADMIN")) %}
                            <li class="dropdown nav-item ms-2">
                                <a href="" class="nav-link text-white fs-4 dropdown-toggle" data-bs-toggle="dropdown"
                                    data-bs-auto-close="outside">Paramêtre</a>
                                <ul class="dropdown-menu bg-dark">
                                    <li class="nav-item ms-2">
                                        <a href="/admin/categorie" class="nav-link text-white">Catégorie</a>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="/admin/user" class="nav-link text-white">User</a>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="/admin/role" class="nav-link text-white">Role</a>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="/admin/typetiers" class="nav-link text-white">Type Tiers</a>
                                    </li>
                                    <li class="nav-item ms-2">
                                        <a href="/admin/typemouvement" class="nav-link text-white">Type Mouvement</a>
                                    </li>
                                </ul>
                            </li>
                            {% endif %}
                        </ul>
                        <div class="d-flex relative">
                            <a href="" class="nav-link text-white dropdown-toggle fs-3 ms-2" data-bs-toggle="dropdown">
                                <i class="fa fa-bell text-white"></i>
                                <sup></sup>
                            </a>
                            <ul class="dropdown-menu w100">
                                <li class="nav-item w100">
                                    <table class="w100 scroll-sm">
                                        <thead>
                                            <tr id="thead_tr_message">
                                                <th colspan="3" class="bg-dark text-white text-center">MESSAGE
                                                    INSTANTANE</th>
                                            </tr>
                                            <tr class="bg-success text-light">
                                                <th class="w20 border-white text-center">Auteur</th>
                                                <th class="w60 border-white text-center">Message</th>
                                                <th class="w20 border-white text-center">Lu
                                                    <br>
                                                    <input type="checkbox" id="selectAll">
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbody_message"></tbody>
                                        <tfoot>
                                            <tr>
                                                <td class="w20 px-2"><input onkeydown="touche1(event)" type="text"
                                                        id="auteur" name="auteur" class="form-control"></td>
                                                <td class="w60 px-2"><input onkeydown="touche2(event)" type="text"
                                                        id="message" name="message" class="form-control"></td>
                                                <td class="w20">
                                                    <button class="btn btn-md w-100 btn-secondary "
                                                        onclick="envoyerMessage()">
                                                        <i class="fa fa-paper-plane mx-2 text-white"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tfoot>

                                    </table>

                                </li>
                            </ul>

                            <button id="etat" onclick="changerEtat()"></button>
                            <div class="input-group">
                                <input type="text" onkeydown="touche(event)" id="mot" name="mot" class="form-control"
                                    autocomplete="off" placeholder="Mot à chercher">
                                <button class="btn bg-dark" onclick="chercher(event)">
                                    <i class="fa fa-search text-white"></i>
                                </button>
                                {% if(app.user) %}
                                    <a href="javascript:void()" class="nav-link text-white fs-4 me-2 dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-user mx-2 my-2"></i>{{app.user.username | capitalize}}</a>
                                    <ul class="dropdown-menu">
                                        <li class="nav-item"><a href="{{path('app_logout')}}" class="nav-link">Se deconnecter</a></li>
                                        <li class="nav-item"><a href="#" class="nav-link">Profil</a></li>
                                        <li class="nav-item"><a href="#" class="nav-link">Mot de passe</a></li>
                                    </ul>
                                {% else %}
                                    <a href="javascript:void()" class="nav-link text-white fs-4 me-2 dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-user mx-2 my-2"></i>Visiteur</a>
                                    <ul class="dropdown-menu">
                                        <li class="nav-item"><a href="{{path('app_login')}}" class="nav-link">Se connecter</a></li>
                                        <li class="nav-item"><a href="{{path('app_register')}}" class="nav-link">S'inscrire</a></li>
                                    </ul>
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </nav>
            </header>
            <main class="container-fluid">
                <div class="row">
                    <aside class="col-md-2 bg-white"> {% block aside_left %}{% endblock %}
                    </aside>
                    <section class="col-md-8 bg-light">
                        <!-- <?=$content?> -->
                        {% block dwwm %}{% endblock %}
                        {% block body%}{% endblock %}
                    </section>
                    <aside class="col-md-2 bg-white"> {% block aside_right %}{% endblock %}
                    </aside>
                </div>
                <div id="attente">
                    <img src="./public/img/loader2.gif" alt="">
                </div>
            </main>
            <footer class="bg-blueNight orange d-flex justify-content-center align-items-center mt-2 w-100">
                <h3>CopyRight &copy DWWM-2024</h3>
            </footer>
            <script src="/js/myScript.js"></script>
            <script src="{{asset('bootstrap-5.3.3-dist/js/bootstrap.bundle.js')}}"></script>
            {%block script%}{%endblock%}
            <script>
                function getMessage() {
                    fetch("index.php?page=message_read").then(response => response.json()).then(messages => {
                        let html = "";
                        messages.forEach(message => {
                            html += `
                            <tr>
                                <td class="w20">${message.auteur
                                }</td>
                                <td class="w60">${message.message
                                }</td>
                                <td class="w20 text-center"><input type="checkbox" id="${message.id
                                }" name="lu" > </td>
                            </tr>
                        `
                        });
                        tbody_message.innerHTML = html;
                        tbody_message.scrollTop = tbody_message.scrollHeight;
                        hideLoader();
                    })
                }
                function changerEtat() {
                    etat.classList.toggle("bg-success");
                }
                function touche1(event) {
                    if (event.keyCode == 13) {
                        message.focus();
                    }
                }
                function touche2(event) {
                    if (event.keyCode == 13) {
                        envoyerMessage();
                    }
                }
                function envoyerMessage() {
                    showLoader();
                    let data = new FormData();
                    data.append('auteur', auteur.value);
                    data.append('message', message.value);
                    fetch("index.php?page=message_write", {
                        method: "POST",
                        body: data
                    }).then(response => response.text()).then(response => {
                        message.value = '';
                        getMessage();
                    }).catch(function (error) {
                        console.log(error);
                        alert("Il existe une erreur!");
                    })
                }
                function envoyerMessage_old() {
                    let data = new FormData();
                    data.append('auteur', auteur.value);
                    data.append('message', message.value);
                    fetch("index.php?page=message_write", {
                        method: "POST",
                        body: data
                    }).then(function (response) {
                        return response.text();
                    }).then(function (data) {
                        alert(data);
                    }).catch(function (error) {
                        console.log(error);
                        alert("Il existe une erreur!");
                    })
                }
    
                function touche(event) {
                    if(event.keyCode == 13) {
                      chercher();
                    }
                }
            </script>
        </div> 
    </body>

</html>


    